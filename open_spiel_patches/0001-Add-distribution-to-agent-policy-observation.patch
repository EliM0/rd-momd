From 964f95d9d72baa64611b87c0d388f5b168a942fc Mon Sep 17 00:00:00 2001
From: Elisa <elisamecp@gmail.com>
Date: Thu, 8 Jun 2023 15:14:20 +0200
Subject: [PATCH] Add distribution to agent policy observation

---
 open_spiel/python/rl_agent_policy.py |  6 +++++-
 open_spiel/python/rl_environment.py  | 21 ++-------------------
 2 files changed, 7 insertions(+), 20 deletions(-)

diff --git a/open_spiel/python/rl_agent_policy.py b/open_spiel/python/rl_agent_policy.py
index 9771d0ca..e521bc4d 100644
--- a/open_spiel/python/rl_agent_policy.py
+++ b/open_spiel/python/rl_agent_policy.py
@@ -46,7 +46,8 @@ class JointRLAgentPolicy(policy.Policy):
     self._agents = agents
     self._obs = {
         "info_state": [None] * game.num_players(),
-        "legal_actions": [None] * game.num_players()
+        "legal_actions": [None] * game.num_players(),
+        "distribution": [None] * game.num_players()
     }
     self._use_observation = use_observation
 
@@ -71,6 +72,9 @@ class JointRLAgentPolicy(policy.Policy):
         if self._use_observation else state.information_state_tensor(player_id))
     self._obs["legal_actions"][player_id] = legal_actions
 
+    if self.game.get_type().short_name == 'mfg_crowd_modelling_2d':
+        self._obs["distribution"][player_id] =  state.distribution_tensor(player_id)
+
     info_state = rl_environment.TimeStep(
         observations=self._obs, rewards=None, discounts=None, step_type=None)
 
diff --git a/open_spiel/python/rl_environment.py b/open_spiel/python/rl_environment.py
index 64b9bf63..29602c25 100644
--- a/open_spiel/python/rl_environment.py
+++ b/open_spiel/python/rl_environment.py
@@ -174,7 +174,6 @@ class Environment(object):
     self._enable_legality_check = enable_legality_check
 
     if isinstance(game, str):
-      print('hi')
       if kwargs:
         game_settings = {key: val for (key, val) in kwargs.items()}
         logging.info("Using game settings: %s", game_settings)
@@ -231,20 +230,12 @@ class Environment(object):
         step_type: A `StepType` value.
     """
     observations = {
-        "info_state": [],
-        "legal_actions": [],
-        "current_player": [],
-        "serialized_state": []
-    }
-    
-    if self.game.get_type().short_name == 'mfg_crowd_modelling_2d':
-      observations = {
         "info_state": [],
         "legal_actions": [],
         "current_player": [],
         "serialized_state": [],
         "distribution": []
-      }
+    }
 
     rewards = []
     step_type = StepType.LAST if self._state.is_terminal() else StepType.MID
@@ -358,20 +349,12 @@ class Environment(object):
     self._sample_external_events()
 
     observations = {
-        "info_state": [],
-        "legal_actions": [],
-        "current_player": [],
-        "serialized_state": []
-    }
-
-    if self.game.get_type().short_name == 'mfg_crowd_modelling_2d':
-      observations = {
         "info_state": [],
         "legal_actions": [],
         "current_player": [],
         "serialized_state": [],
         "distribution": []
-      }
+    }
 
     for player_id in range(self.num_players):
       observations["info_state"].append(
-- 
2.25.1

